# æ—¥å¿—ç³»ç»Ÿä½¿ç”¨è¯´æ˜

## ğŸ“Š æ—¥å¿—è¾“å‡ºæ–¹å¼

é¡¹ç›®ä¸­æœ‰ä¸¤ç§ä¸»è¦çš„æ—¥å¿—è¾“å‡ºæ–¹å¼ï¼š

### 1. Android Logcat (`logd`, `loge`, `logi`, `logw`)
- **è¾“å‡ºä½ç½®**: Android logcat
- **æŸ¥çœ‹æ–¹å¼**: `adb logcat | grep UInjector`
- **ç‰¹ç‚¹**: 
  - å§‹ç»ˆè¾“å‡ºåˆ° logcat
  - ä¸å— stdout é‡å®šå‘å½±å“
  - é€‚åˆè°ƒè¯•å’Œé”™è¯¯è¿½è¸ª

### 2. Console Logger (`console->info()`, `console->error()`)
- **è¾“å‡ºä½ç½®**: stdout (æ ‡å‡†è¾“å‡º)
- **æŸ¥çœ‹æ–¹å¼**: 
  - Debug æ¨¡å¼: å‘½ä»¤è¡Œ
  - Socket æ¨¡å¼: è¿æ¥çš„å®¢æˆ·ç«¯ (nc/telnet)
- **ç‰¹ç‚¹**:
  - ä½¿ç”¨ spdlog åº“
  - æ”¯æŒæ ¼å¼åŒ–è¾“å‡º
  - åœ¨ socket æ¨¡å¼ä¸‹ä¼šè¢«é‡å®šå‘åˆ°å®¢æˆ·ç«¯

---

## ğŸ”„ Socket æ¨¡å¼ä¸‹çš„è¾“å‡ºé‡å®šå‘

### é—®é¢˜è¯´æ˜

åœ¨ socket æ¨¡å¼ä¸‹ï¼ˆæ³¨å…¥åˆ°åº”ç”¨åï¼‰ï¼Œ`LuaReplServer` ä¼šæ‰§è¡Œï¼š

```cpp
dup2(clientSocket, STDOUT_FILENO);
```

è¿™ä¼šå°† **stdout é‡å®šå‘åˆ° socket å®¢æˆ·ç«¯**ï¼Œå¯¼è‡´ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ³¨å…¥å‰                                                  â”‚
â”‚  console->info() â”€â”€â†’ stdout â”€â”€â†’ å‘½ä»¤è¡Œ/logcat          â”‚
â”‚  logd()          â”€â”€â†’ logcat                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç«¯è¿æ¥å                                            â”‚
â”‚  console->info() â”€â”€â†’ stdout â”€â”€â†’ socket â”€â”€â†’ nc å®¢æˆ·ç«¯   â”‚
â”‚  logd()          â”€â”€â†’ logcat                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å½±å“

- âœ… `logd()` å§‹ç»ˆè¾“å‡ºåˆ° logcatï¼Œä¸å—å½±å“
- âš ï¸ `console->info()` åœ¨å®¢æˆ·ç«¯è¿æ¥åè¾“å‡ºåˆ° socket
- âš ï¸ å¦‚æœæ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œ`console->info()` çš„è¾“å‡ºä¼šä¸¢å¤±

---

## ğŸ¯ ä½¿ç”¨å»ºè®®

### åœºæ™¯ 1: éœ€è¦åœ¨ logcat ä¸­æŸ¥çœ‹
**ä½¿ç”¨**: `logd()`, `loge()`, `logi()`, `logw()`

```cpp
logd("Process ID: %d", getpid());
loge("Error: %s", error_msg);
```

**é€‚ç”¨äº**:
- è°ƒè¯•ä¿¡æ¯
- é”™è¯¯è¿½è¸ª
- æ€§èƒ½åˆ†æ
- ä¸éœ€è¦ç”¨æˆ·çœ‹åˆ°çš„å†…éƒ¨æ—¥å¿—

---

### åœºæ™¯ 2: éœ€è¦åœ¨å®¢æˆ·ç«¯çœ‹åˆ°
**ä½¿ç”¨**: `console->info()`, `console->error()`

```cpp
console->info("Server started on port {}", port);
console->error("Connection failed: {}", error);
```

**é€‚ç”¨äº**:
- ç”¨æˆ·äº¤äº’ä¿¡æ¯
- å‘½ä»¤æ‰§è¡Œç»“æœ
- çŠ¶æ€æç¤º
- éœ€è¦å®æ—¶åé¦ˆçš„ä¿¡æ¯

---

### åœºæ™¯ 3: éœ€è¦åŒæ—¶åœ¨ logcat å’Œå®¢æˆ·ç«¯çœ‹åˆ°
**ä½¿ç”¨**: `LOG_BOTH_INFO()`, `LOG_BOTH_ERROR()`, `LOG_BOTH_WARN()`

```cpp
LOG_BOTH_INFO("declaring_class_: {:p}", ptr);
LOG_BOTH_ERROR("Failed to initialize: {}", reason);
```

**é€‚ç”¨äº**:
- é‡è¦çš„çŠ¶æ€ä¿¡æ¯
- å…³é”®é”™è¯¯
- éœ€è¦è®°å½•å’Œæ˜¾ç¤ºçš„ä¿¡æ¯
- è°ƒè¯•å¤æ‚é—®é¢˜æ—¶

---

## ğŸ“ å®å®šä¹‰è¯´æ˜

### Android Logcat å®

```cpp
#define logd(...) __android_log_print(ANDROID_LOG_DEBUG, TAG, __VA_ARGS__)
#define loge(...) __android_log_print(ANDROID_LOG_ERROR, TAG, __VA_ARGS__)
#define logi(...) __android_log_print(ANDROID_LOG_INFO, TAG, __VA_ARGS__)
#define logw(...) __android_log_print(ANDROID_LOG_WARN, TAG, __VA_ARGS__)
```

**ç‰¹ç‚¹**:
- ä½¿ç”¨ printf é£æ ¼æ ¼å¼åŒ–
- ç›´æ¥è¾“å‡ºåˆ° Android logcat
- TAG ä¸º "UInjector"

**ç¤ºä¾‹**:
```cpp
logd("Value: %d, String: %s", 42, "hello");
loge("Error code: %d", errno);
```

---

### Console Logger

```cpp
console->info("format", args...);
console->error("format", args...);
console->warn("format", args...);
console->debug("format", args...);
```

**ç‰¹ç‚¹**:
- ä½¿ç”¨ fmt åº“æ ¼å¼åŒ–ï¼ˆç±»ä¼¼ Pythonï¼‰
- è¾“å‡ºåˆ° stdout
- æ”¯æŒå½©è‰²è¾“å‡ºï¼ˆåœ¨ç»ˆç«¯ä¸­ï¼‰

**ç¤ºä¾‹**:
```cpp
console->info("Value: {}, String: {}", 42, "hello");
console->error("Pointer: {:p}", ptr);
console->warn("Hex: {:#x}", value);
```

---

### åŒè¾“å‡ºå®

```cpp
#define LOG_BOTH_INFO(fmt, ...) \
    do { \
        logd(fmt, ##__VA_ARGS__); \
        if (console) console->info(fmt, ##__VA_ARGS__); \
    } while(0)

#define LOG_BOTH_ERROR(fmt, ...) \
    do { \
        loge(fmt, ##__VA_ARGS__); \
        if (console) console->error(fmt, ##__VA_ARGS__); \
    } while(0)

#define LOG_BOTH_WARN(fmt, ...) \
    do { \
        logw(fmt, ##__VA_ARGS__); \
        if (console) console->warn(fmt, ##__VA_ARGS__); \
    } while(0)
```

**ç‰¹ç‚¹**:
- åŒæ—¶è¾“å‡ºåˆ° logcat å’Œ console
- ä½¿ç”¨ fmt æ ¼å¼åŒ–è¯­æ³•
- è‡ªåŠ¨æ£€æŸ¥ console æ˜¯å¦åˆå§‹åŒ–

**ç¤ºä¾‹**:
```cpp
LOG_BOTH_INFO("Server listening on port {}", 8024);
LOG_BOTH_ERROR("Failed to bind: {}", error_msg);
```

---

## ğŸ” æ ¼å¼åŒ–è¯­æ³•å¯¹æ¯”

### printf é£æ ¼ (logd)

```cpp
logd("Int: %d, Hex: %x, Ptr: %p, String: %s", 42, 0xFF, ptr, "hello");
```

### fmt é£æ ¼ (console, LOG_BOTH)

```cpp
console->info("Int: {}, Hex: {:#x}, Ptr: {:p}, String: {}", 42, 0xFF, ptr, "hello");
LOG_BOTH_INFO("Int: {}, Hex: {:#x}, Ptr: {:p}, String: {}", 42, 0xFF, ptr, "hello");
```

**fmt æ ¼å¼è¯´æ˜**:
- `{}` - è‡ªåŠ¨æ ¼å¼åŒ–
- `{:d}` - åè¿›åˆ¶æ•´æ•°
- `{:#x}` - åå…­è¿›åˆ¶ï¼ˆå¸¦ 0x å‰ç¼€ï¼‰
- `{:p}` - æŒ‡é’ˆ
- `{:08x}` - 8ä½åå…­è¿›åˆ¶ï¼Œå‰å¯¼é›¶

---

## ğŸ§ª å®é™…ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: å‡½æ•°è°ƒè¯•

```cpp
void myFunction(int value, void* ptr) {
    // è°ƒè¯•ä¿¡æ¯ - åªåœ¨ logcat
    logd("myFunction called: value=%d, ptr=%p", value, ptr);
    
    // ç”¨æˆ·å¯è§ä¿¡æ¯ - å‘é€åˆ°å®¢æˆ·ç«¯
    console->info("Processing value: {}", value);
    
    // é‡è¦ä¿¡æ¯ - åŒæ—¶è®°å½•å’Œæ˜¾ç¤º
    LOG_BOTH_INFO("Result: {:p}", result);
}
```

### ç¤ºä¾‹ 2: é”™è¯¯å¤„ç†

```cpp
if (error) {
    // è¯¦ç»†é”™è¯¯ - logcat
    loge("Error details: code=%d, msg=%s", error_code, error_msg);
    
    // ç”¨æˆ·å‹å¥½é”™è¯¯ - å®¢æˆ·ç«¯
    console->error("Operation failed: {}", user_friendly_msg);
    
    // å…³é”®é”™è¯¯ - ä¸¤è€…éƒ½è¦
    LOG_BOTH_ERROR("Critical error: {}", critical_msg);
}
```

### ç¤ºä¾‹ 3: çŠ¶æ€ä¿¡æ¯

```cpp
void startServer(int port) {
    // å†…éƒ¨æ—¥å¿—
    logd("Initializing server on port %d", port);
    
    // ç”¨æˆ·æç¤º
    console->info("Starting server...");
    
    // æˆåŠŸä¿¡æ¯ - ä¸¤è€…éƒ½æ˜¾ç¤º
    LOG_BOTH_INFO("Server started successfully on port {}", port);
}
```

---

## ğŸ“‹ æœ€ä½³å®è·µ

### 1. é€‰æ‹©åˆé€‚çš„æ—¥å¿—çº§åˆ«

```cpp
// è°ƒè¯•ä¿¡æ¯ - å¼€å‘æ—¶ä½¿ç”¨
logd("Debug: variable=%d", var);

// æ™®é€šä¿¡æ¯ - æ­£å¸¸æ“ä½œ
logi("Operation completed");
console->info("Command executed");

// è­¦å‘Š - å¯èƒ½çš„é—®é¢˜
logw("Warning: deprecated function");
console->warn("Using fallback method");

// é”™è¯¯ - éœ€è¦æ³¨æ„çš„é—®é¢˜
loge("Error: failed to open file");
console->error("Connection lost");
```

### 2. é¿å…è¿‡åº¦æ—¥å¿—

```cpp
// âŒ ä¸å¥½ - å¤ªå¤šæ—¥å¿—
for (int i = 0; i < 1000; i++) {
    logd("Processing item %d", i);  // ä¼šäº§ç”Ÿ 1000 æ¡æ—¥å¿—
}

// âœ… å¥½ - é€‚åº¦æ—¥å¿—
logd("Processing %d items", count);
for (int i = 0; i < 1000; i++) {
    // å¤„ç†...
}
logd("Processing complete");
```

### 3. ä½¿ç”¨æœ‰æ„ä¹‰çš„æ¶ˆæ¯

```cpp
// âŒ ä¸å¥½
logd("Error");
console->info("Done");

// âœ… å¥½
loge("Failed to allocate memory: size=%zu", size);
console->info("Successfully loaded {} modules", count);
```

### 4. åŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯

```cpp
// âŒ ä¸å¥½
loge("Connection failed");

// âœ… å¥½
loge("Connection failed: host=%s, port=%d, error=%s", 
     host, port, strerror(errno));
```

---

## ğŸ”§ è°ƒè¯•æŠ€å·§

### 1. å®æ—¶æŸ¥çœ‹ logcat

```bash
# è¿‡æ»¤ UInjector çš„æ—¥å¿—
adb logcat | grep UInjector

# åªçœ‹é”™è¯¯
adb logcat | grep -E "UInjector.*E/"

# å½©è‰²è¾“å‡º
adb logcat -v color | grep UInjector
```

### 2. åŒæ—¶æŸ¥çœ‹ logcat å’Œå®¢æˆ·ç«¯è¾“å‡º

```bash
# ç»ˆç«¯ 1: logcat
adb logcat | grep UInjector

# ç»ˆç«¯ 2: è¿æ¥å®¢æˆ·ç«¯
adb shell nc 127.0.0.1 8024
```

### 3. ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶

```bash
# ä¿å­˜æ‰€æœ‰æ—¥å¿—
adb logcat > full_log.txt

# åªä¿å­˜ UInjector æ—¥å¿—
adb logcat | grep UInjector > uinjector_log.txt
```

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆ console->info() æ²¡æœ‰è¾“å‡ºï¼Ÿ

**A**: å¯èƒ½çš„åŸå› ï¼š
1. åœ¨ socket æ¨¡å¼ä¸‹ï¼Œè¾“å‡ºè¢«é‡å®šå‘åˆ°å®¢æˆ·ç«¯
2. æ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œè¾“å‡ºä¸¢å¤±
3. console æœªåˆå§‹åŒ–

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨ `logd()` è¾“å‡ºåˆ° logcat
- æˆ–ä½¿ç”¨ `LOG_BOTH_INFO()` åŒæ—¶è¾“å‡º

### Q: å¦‚ä½•åœ¨å®¢æˆ·ç«¯çœ‹åˆ°æ‰€æœ‰è¾“å‡ºï¼Ÿ

**A**: 
1. ç¡®ä¿ä½¿ç”¨ `console->info()` æˆ– `LOG_BOTH_INFO()`
2. è¿æ¥åˆ° socket: `adb shell nc 127.0.0.1 8024`
3. æ‰§è¡Œ Lua å‘½ä»¤è§¦å‘è¾“å‡º

### Q: æ—¥å¿—å¤ªå¤šæ€ä¹ˆåŠï¼Ÿ

**A**:
1. ä½¿ç”¨åˆé€‚çš„æ—¥å¿—çº§åˆ«
2. åœ¨ Release ç‰ˆæœ¬ä¸­ç¦ç”¨ debug æ—¥å¿—
3. ä½¿ç”¨æ¡ä»¶ç¼–è¯‘ï¼š
```cpp
#ifdef DEBUG_PROJECT
    logd("Debug info: %d", value);
#endif
```

---

## ğŸ“š å‚è€ƒ

- [spdlog æ–‡æ¡£](https://github.com/gabime/spdlog)
- [fmt æ ¼å¼åŒ–è¯­æ³•](https://fmt.dev/latest/syntax.html)
- [Android Log æ–‡æ¡£](https://developer.android.com/ndk/reference/group/logging)
